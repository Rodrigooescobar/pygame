import pygame
import sys
import colores
from player import *
from enemy import *
from constantes import *
from colisiones import *


SHOT_ENEMY = pygame.USEREVENT + 1

class Game:
    def __init__(self) -> None:
       pygame.init()
       self.pantalla = pygame.display.set_mode(RESOLUCION)
       self.fondo = pygame.image.load("imagenes/fondo.png")
       self.fondo = pygame.transform.scale(
           self.fondo, (ANCHO_VENTANA, ALTO_VENTANA))
       self.rect_fondo = self.fondo.get_rect()
       self.gameover = True
       self.score = 0
       self.fps = FPS
       pygame.mixer.music.load("music/stranger.wav")
       pygame.mixer.music.play(-1)
       

    def eventos(self):
        lista_eventos = pygame.event.get()
        for evento in lista_eventos:
            if evento.type == pygame.QUIT:
                self.gameover = False
                pygame.quit()
                sys.exit()
            elif evento.type == pygame.KEYDOWN:
                if evento.key == pygame.K_SPACE:
                    self.player.shot_player()
                    pygame.time.set_timer(SHOT_ENEMY, 100)
                    self.fps = 10
                    for enemy in self.lista_enemy:
                        enemy.shot_enemy(self.lista_proyectil_enemy)
                    
    
    def new_game(self):
        self.score = 0
        self.lista_proyectil_player = []
        self.player = Player(self, 1500, self.score, self.lista_proyectil_player)
        self.lista_proyectil_enemy = []
        self.lista_enemy = Enemy.crear_lista_ovnis(self, 1, 5, 80, 100, 100, 0, 400, self.lista_proyectil_enemy)
        self.colisiones = Colisiones(self.player, self.lista_proyectil_player, self.lista_enemy, self.lista_proyectil_enemy, self.score)
        # self.enemigos = Enemy(0, 0, 0, 0, [], [])
        # self.lista_enemy = self.enemigos.crear_lista_ovnis(
        #     5, 2, 80, 100, 100, 0, 20, self.lista_proyectil_enemy)
        

    def draw(self):
        self.pantalla.blit(self.fondo, self.rect_fondo)
        self.pantalla.blit(self.texto, (10, 10))
        self.player.draw_player(self.pantalla)
        for enemy in self.lista_enemy:
            enemy.draw_enemy(self.pantalla)
        #pygame.draw.rect(self.pantalla, (255, 0, 0), self.player.rect_player)

        # for proyectil in enemy.lista_proyectil_enemy:
        #     proyectil.draw_disparo_enemigo(self.pantalla)

    def update(self):
        self.player.update_player(5)
        for enemy in self.lista_enemy:
            enemy.update_enemy()
        #self.colisiones.verificar_colisiones()
            
        

    def actualizar_pantalla(self):
        self.font = pygame.font.SysFont("Arial", 30)
        self.texto = self.font.render(
            "SCORE: {0}".format(self.score), True, colores.WHITE)
        self.score = self.colisiones.verificar_colisiones()
        



    def run(self):
        self.clock = pygame.time.Clock()
        self.new_game()
        while self.gameover:
            self.clock.tick(FPS)
            self.eventos()
            self.update()
            self.actualizar_pantalla()
            self.draw()
            pygame.display.flip()

juego = Game()
juego.run()
